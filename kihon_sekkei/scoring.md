# データモデル スコアリング評価

| 項目 | 内容 |
|------|------|
| 対象文書 | kihon_sekkei/datamodels.md |
| 評価日 | 2026-02-13 |
| 評価方式 | 5軸×10点満点（合計50点満点） |

---

## 1. スコアリング結果

| # | 評価軸 | 案A: シンプル型 | 案B: バランス型 | 案C: 高拡張性型 |
|---|--------|:--------------:|:--------------:|:--------------:|
| 1 | パフォーマンス | **9** | **8** | **6** |
| 2 | 拡張性 | **3** | **7** | **10** |
| 3 | 保守性 | **9** | **7** | **4** |
| 4 | 実装コスト | **10** | **7** | **3** |
| 5 | データ整合性 | **4** | **8** | **9** |
| | **合計** | **35** | **37** | **32** |

### レーダーチャート用データ

```
              パフォーマンス
                  10
                  │
                  │
  実装コスト ─────┼───── 拡張性
                  │
                  │
   保守性 ────────┼──────── データ整合性

案A: 9, 3, 9, 10, 4  (合計35)  ── 左上に偏る（速い・安い・わかりやすいが脆い）
案B: 8, 7, 7,  7, 8  (合計37)  ── 五角形が最もバランスよく大きい
案C: 6, 10, 4, 3, 9  (合計32)  ── 右下に偏る（堅牢・柔軟だが重い）
```

---

## 2. 各スコアの根拠

### 評価軸1: パフォーマンス（検索・集計速度）

| 案 | 点数 | 根拠 |
|----|:----:|------|
| A | **9** | `daily_attendances` の1テーブルで打刻・残業・承認が完結するため、JOINなしで日次・月次の集計が可能。500名×365日×5年=約91万レコードでもインデックスで十分高速 |
| B | **8** | 日次参照は `daily_work_summaries` 単体で高速。月次集計は `monthly_summaries` の非正規化テーブルで対応。ただし日次詳細の表示に `time_stamps` + `overtime_requests` のJOINが必要で、案Aよりわずかに劣る |
| C | **6** | `daily_records` + `workflow_requests` + `workflow_request_details`（EAV）+ `approval_events` の多段JOINが頻出。EAVパターンはインデックスが効きにくく、申請詳細の取得でN+1問題が発生しやすい。月次サマリーがあるため集計自体は案Bと同等だが、詳細表示のレイテンシが課題 |

### 評価軸2: 拡張性（機能追加の容易さ）

| 案 | 点数 | 根拠 |
|----|:----:|------|
| A | **3** | 1日複数回の出退勤（中抜け）に構造的に対応不可。フレックスタイムの残業計算基準の変更には `daily_attendances` のカラム追加が必要で、テーブルが際限なく肥大化する。新しい申請種別の追加には大幅なスキーマ変更が伴う |
| B | **7** | テーブル追加で中抜け・フレックスに対応可能。残業申請テーブルが独立しているため、新しい申請種別は新テーブルで対応できる。ただし `approval_histories` のポリモーフィックリレーションは、申請種別が増えるたびにENUM値の追加が必要 |
| C | **10** | 汎用ワークフロー（`workflow_requests` + `workflow_request_details`）により、新しい申請種別はマスタ設定の追加のみで対応可能。`work_patterns` で勤務形態、`employee_assignments` で異動、`approval_steps` で承認ルートを柔軟に変更できる。イベントソーシングにより打刻種別の追加も `event_type` のENUM拡張だけで済む |

### 評価軸3: 保守性（理解しやすさ）

| 案 | 点数 | 根拠 |
|----|:----:|------|
| A | **9** | テーブル5つで構造が直感的。「1日1レコード」のメンタルモデルが明確で、新規メンバーが即日で理解できる。デバッグ時も `daily_attendances` を見れば全情報が揃う |
| B | **7** | テーブル9つは妥当な範囲。打刻・申請・承認の責務分離が明確で、各テーブルの役割を理解すれば全体像を把握できる。`approval_histories` のポリモーフィックリレーションがやや直感的でないが、ドキュメントで補える |
| C | **4** | テーブル14つに加え、EAVパターン（`workflow_request_details`）と汎用ワークフローの概念理解が必要。「残業申請の理由を取得する」だけで `workflow_requests` → `workflow_request_details` WHERE `field_key = 'reason'` というクエリが必要になり、直感的でない。新規メンバーのオンボーディングに1〜2週間を要する |

### 評価軸4: 実装コスト（低コストなら高得点）

| 案 | 点数 | 根拠 |
|----|:----:|------|
| A | **10** | CRUD APIが5テーブル分で最小。承認ワークフローも `daily_attendances` のステータス更新のみで実現でき、開発期間1〜2ヶ月で実装可能。フレームワークのscaffold機能でほぼ自動生成できるレベル |
| B | **7** | 9テーブルのCRUD + 月次サマリーの更新ロジック + 承認ワークフローの実装が必要。開発期間3〜4ヶ月。標準的なWebフレームワークで素直に実装でき、特殊な技術要素はない |
| C | **3** | 汎用ワークフローエンジンの設計・実装が最大のコスト要因。EAVパターンのバリデーション層、多段承認の動的ルート解決、イベントソーシングの整合性管理など、高度な設計スキルが必要。開発期間6〜9ヶ月。マスタ管理画面（勤務パターン・承認ステップ・カレンダー）の追加開発も必要 |

### 評価軸5: データ整合性（矛盾の起きにくさ）

| 案 | 点数 | 根拠 |
|----|:----:|------|
| A | **4** | 残業申請がない日は残業関連カラムが全てNULLになり、「NULLは未申請なのか入力漏れなのか」が判別しにくい。承認の差戻し→再申請で前の状態が上書きされ、履歴が失われる。`approval_status` の遷移をアプリ層で制御する必要があり、不正遷移（`approved` → `pending`）をDB制約だけでは防げない |
| B | **8** | 打刻・申請・承認が分離されているため、各テーブルのNOT NULL制約・外部キー制約を適切に設定でき、DB層でのデータ整合性が高い。`approval_histories` で承認イベントが全て記録されるため、状態の矛盾が追跡可能。`monthly_summaries` の整合性（日次データとの不一致）を維持するコストがある点のみ減点 |
| C | **9** | イベントソーシングにより、`stamp_events` / `approval_events` は追記のみ（UPDATE/DELETEなし）でデータの不変性が保証される。`employee_assignments` の時系列管理で異動時の承認権限の整合性が自然に保たれる。EAVパターンの `workflow_request_details` で型安全性をDB層で保証できない点のみ減点。全体として最も矛盾が起きにくい設計 |

---

## 3. 総合評価

### 合計スコア

```
案B（37点）> 案A（35点）> 案C（32点）
```

### 分析

| 案 | 強み | 弱み | 特徴 |
|----|------|------|------|
| A | パフォーマンス・保守性・実装コストの3軸で高得点 | 拡張性（3点）とデータ整合性（4点）が著しく低い | **「速く安く作れるが、成長に耐えられない」** |
| B | 全5軸で7〜8点の安定したスコア。最低点が7点で弱点がない | 突出した1位の軸がない | **「どの軸も及第点以上で、総合力が最も高い」** |
| C | 拡張性（10点）とデータ整合性（9点）で圧倒的 | 保守性（4点）と実装コスト（3点）が低く、初期投資が大きい | **「将来に強いが、今のコストが重い」** |

### 結論

**案Bが総合スコア37点で最高評価**となった。requirement_v3.md の対象規模（ASM-001: 500名）に対して、5軸すべてで7点以上を確保しており、最もバランスの取れた設計である。

案Aは実装コスト面で優れるが、v3で追加された REQ-042（事後申請率モニタリング）やREQ-022（監査証跡）の要件充足に構造的な制約がある。案Cは将来性に優れるが、現時点の要件に対してはオーバースペックであり、実装コストと保守性のリスクが高い。
